<html>
    <head>
        <script src="js/webgl-utils.js" type="text/javascript"></script>
        <script src="js/gl-matrix-min.js" type="text/javascript"></script>
        <script src="js/game.js" type="text/javascript"></script>
        <script src="js/shared.js" type="text/javascript"></script>
        <script src="./socket.io/socket.io.js"></script>
        <script src="js/gameclient3d.js" type="text/javascript"></script>
        <style>
            body {
                font-size: 25px;
            }
            .bonus_cards {
                color: rgb( 192,192,192);
            }
        </style>
        <script id="VertexShader" type="x-shader/x-vertex">
            uniform mat4 world;
            uniform mat4 view_proj;

            attribute vec3 local_position;
            attribute vec3 local_normal;
            //attribute vec4 local_tangent;
            //attribute vec2 local_uv;
            
            //varying vec2 uv;
            //varying vec3 tangent_light_direction;
            //varying vec4 colour;

            varying float light;

            void main()
            {
                vec4 world_position = world * vec4( local_position, 1.0 );
                vec3 world_normal = normalize( mat3( world ) * local_normal );
                //vec3 world_tangent = normalize( mat3( world ) * local_tangent.xyz ); 

                //vec3 world_binormal = -cross( world_normal, world_tangent ) * local_tangent.w;

                vec3 light_direction = normalize( vec3( -1.0, -1.0, 1.0 ) );
                light = dot( light_direction, world_normal );
                //tangent_light_direction.xyz = vec3( dot( world_tangent, light_direction ), dot( world_binormal, light_direction ), dot( world_normal, light_direction ) );

                gl_Position = view_proj * world_position;
                //uv = local_uv;
            }
        </script>
        <script id="PixelShader" type="x-shader/x-fragment">
            precision mediump float;

            //uniform sampler2D colour_map;
            //uniform sampler2D normal_map;

            //varying vec4 colour;

            //varying vec2 uv;
            //varying vec3 tangent_light_direction;
            varying float light;
            uniform vec4 colour;

            void main()
            {
                //vec4 albedo = texture2D( colour_map, uv );
                //if( albedo.w < 1.0 )
                //    discard;
                //albedo.xyz = pow( albedo.xyz, vec3( 1.0 / 2.2, 1.0 / 2.2, 1.0 / 2.2 ) );

                //vec3 ambient = vec3( 0.0, 0.0, 0.04 );

                //vec4 ns = texture2D( normal_map, uv );
                //vec3 normal = normalize( ns.xyz - 0.5 );
                //float specular_colour = ns.w;

                //vec3 light_direction = normalize( tangent_light_direction );
                //vec3 light_colour = vec3( 1.04, 1.04, 1.0 ) * 1.1;

                //float falloff = 1.0;
                //vec3 diffuse = dot( light_direction, normal ) * falloff * light_colour.xyz + ambient;

                //vec3 specular = vec3( 0.0, 0.0, 0.0 );
                //vec3 result = albedo.xyz * diffuse + specular + ambient;

                //gl_FragColor = vec4( pow( result, vec3( 2.2, 2.2, 2.2 ) ), albedo.w );
                gl_FragColor = colour * light;
            }
        </script> 
    </head>
    <body onload="startGame(); startGame2d( global_game ); game_display_3d = new gameDisplay3d( global_game );" style="white-space: nowrap;">
        <p id="status"></p>
        <form id="network_options_form">
            <input id="localMultiplayerButton" type="button" value="Play locally" name="localMultiplayer" />
            <input id="networkMultiplayerButton" type="button" value="Find an opponent online" name="networkMultiplayer" />
        </form>
        <div id="serverMessages"></div>
        <canvas id='game' width="450" height="450" style="display: inline-block;">
        </canvas>
        <canvas id='game3d' style="display: inline-block;" width="800" height="800">
        </canvas>
        <div>
            <span id="cards">
            </span>
            <form>
                <input id="end_turn_button" type="button" value="End Turn" />
            </form>
        </div>

        <div id="build_menu" style="display: none; position: absolute; border: 1px solid; padding: 3px; background-color: white;">
            <form id="build_menu_form" style="margin: 0px;">
                <input id="build0" type="button" value="Destroy" name="0" />
                <input id="build1" type="button" value="Road" name="1" />
                <input id="build2" type="button" value="Pipe" name="2"/>
                <input id="build3" type="button" value="Line" name="3"/>
                <input id="build4" type="button" value="Fibre" name="4"/>
            </form>
        </div>
        <span id="board" style="color: rgb( 255, 255, 0 );" />
    </body>
</html>